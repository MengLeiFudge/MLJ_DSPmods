<?xml version="1.0" encoding="utf-8"?>

<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFramework>net472</TargetFramework>
        <BepInExPluginGuid>com.menglei.dsp.dspdata</BepInExPluginGuid>
        <Description>DSP MOD - GetDspData</Description>
        <Version>1.0.0</Version>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <LangVersion>latest</LangVersion>
        <PackageId>GetDspData</PackageId>
        <RootNamespace>GetDspData</RootNamespace>
        <RestoreAdditionalProjectSources>https://nuget.bepinex.dev/v3/index.json</RestoreAdditionalProjectSources>
        <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    </PropertyGroup>
    <ItemGroup>
        <PackageReference Include="BepInEx.Core" Version="5.4.17"/>
        <PackageReference Include="BepInEx.PluginInfoProps" Version="1.0.0"/>
        <PackageReference Include="UnityEngine.Modules" Version="2018.4.12" IncludeAssets="compile"/>
        <PackageReference Include="DysonSphereProgram.Modding.CommonAPI" Version="1.6.5"/>
        <PackageReference Include="DysonSphereProgram.Modding.LDBTool" Version="3.0.0"/>
        <!-- 排除 GameLibs 中的 Assembly-CSharp.dll -->
        <PackageReference Include="DysonSphereProgram.GameLibs" Version="*-r.*"
                          ExcludeAssets="lib\**\Assembly-CSharp.dll"/>
        <!-- 添加本地 Assembly-CSharp-publicized.dll -->
        <Reference Include="Assembly-CSharp">
            <HintPath>..\lib\Assembly-CSharp-publicized.dll</HintPath>
            <!-- 确保本地 DLL 优先 -->
            <Private>True</Private>
        </Reference>
        <PackageReference Include="Newtonsoft.Json" Version="13.0.3"/>
        <ProjectReference Include="..\FractionateEverything\FractionateEverything.csproj"/>
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework.TrimEnd(`0123456789`))' == 'net'">
        <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies" Version="1.0.3" PrivateAssets="all"/>
    </ItemGroup>
    <Target Name="PostBuild" AfterTargets="PostBuildEvent" Condition="'$(Configuration)' == 'Release'">
        <Exec Command="del /F /Q package\$(ProjectName)-$(Version).zip&#xA;powershell Compress-Archive -Force -DestinationPath 'package/$(ProjectName)-$(Version).zip' -Path &quot;$(TargetPath)&quot;, package/icon.png, package/manifest.json, README.md, CHANGELOG.md"/>
    </Target>
</Project>